<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iwtoms - Responsive Timetable</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --background-color: #ecf0f1;
            --text-color: #34495e;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        h1 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            flex: 1;
            overflow: hidden;
        }

        #timetable-container {
            flex: 1;
            overflow-x: auto;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        table {
            border-collapse: separate;
            border-spacing: 1px;
            width: 100%;
            min-width: 800px;
        }

        th, td {
            padding: 12px;
            text-align: center;
            vertical-align: middle;
        }

        th {
            background-color: var(--primary-color);
            color: #fff;
            font-weight: bold;
            text-transform: uppercase;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td:first-child {
            position: sticky;
            left: 0;
            background-color: var(--secondary-color);
            color: #fff;
            font-weight: bold;
            z-index: 5;
            font-size: 0.8em;
            padding: 8px;
        }

        .subject, .classroom {
            padding: 8px 12px;
            margin: 5px;
            cursor: move;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .subject:hover, .classroom:hover {
            transform: scale(1.05);
        }

        .timeslot {
            height: 80px;
            transition: background-color 0.3s ease;
        }

        .interval {
            height: 40px;
            background-color: #f0f0f0;
            font-style: italic;
            font-size: 0.8em;
        }

        .timeslot.dragover {
            background-color: rgba(52, 152, 219, 0.2);
        }

        .timeslot-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .timeslot-subject {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .timeslot-classroom {
            font-size: 0.8em;
            color: #fff;
            background-color: var(--secondary-color);
            padding: 2px 6px;
            border-radius: 4px;
        }

        #draggables {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        .draggable-section {
            flex: 1;
            min-width: 250px;
            max-width: 400px;
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .draggable-section h2 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        details {
            margin-bottom: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
            padding: 10px;
        }

        summary {
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 10px;
        }

        details[open] summary::after {
            content: "▲";
            float: right;
        }

        summary::after {
            content: "▼";
            float: right;
        }

        #controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #2980b9;
        }

        #search-container {
            margin-bottom: 20px;
            text-align: center;
        }

        #search-input {
            padding: 10px;
            width: 100%;
            max-width: 300px;
            border: 1px solid var(--primary-color);
            border-radius: 4px;
            font-size: 16px;
        }

        #color-palette {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .palette-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .palette-option.active {
            border-color: #000;
        }

        #current-future-classes {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 20px;
        }

        .class-info {
            flex: 1;
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .class-info h2 {
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        .class-info div {
            font-size: 1em;
        }

        @media (max-width: 767px) {
            body {
                padding: 10px;
            }

            #timetable-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            table {
                min-width: 100%;
            }

            th, td {
                padding: 6px;
                font-size: 0.8em;
            }

            td:first-child {
                font-size: 0.7em;
                padding: 4px;
                width: 40px;
                min-width: 40px;
            }

            .timeslot {
                height: 50px;
            }

            .interval {
                height: 25px;
            }

            #draggables {
                flex-direction: column;
            }

            .draggable-section {
                max-width: 100%;
            }

            .subject, .classroom {
                display: inline-block;
                margin: 2px;
                padding: 4px 8px;
                font-size: 0.8em;
            }

            #current-future-classes {
                flex-direction: column;
            }

            .class-info {
                margin-bottom: 10px;
            }

            #controls {
                flex-direction: column;
                align-items: center;
            }

            button {
                width: 100%;
                max-width: 300px;
            }
        }
          @media (max-width: 767px) {
            #timetable-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            table {
                min-width: 100%;
            }

            th, td {
                padding: 6px;
                font-size: 0.8em;
            }

            td:first-child {
                font-size: 0.7em;
                padding: 4px;
                width: 40px;
                min-width: 40px;
            }

            .timeslot {
                height: 50px;
            }

            .interval {
                height: 25px;
            }

            #draggables {
                flex-direction: column;
            }

            .draggable-section {
                max-width: 100%;
            }

            .subject, .classroom {
                display: inline-block;
                margin: 2px;
                padding: 4px 8px;
                font-size: 0.8em;
            }

            #current-future-classes {
                flex-direction: column;
            }

            .class-info {
                margin-bottom: 10px;
            }

            #controls {
                flex-direction: column;
                align-items: center;
            }

            button {
                width: 100%;
                max-width: 300px;
            }
        }

        /* Subject Colors - Default Palette */
        .informatica { background-color: #C65D34; color: white; }
        .lingua-inglese { background-color: #7A9BFF; color: black; }
        .gestione-progetto { background-color: #D4C95D; color: black; }
        .lettere { background-color: #A47B4D; color: white; }
        .tp-informatici { background-color: #E3A64E; color: black; }
        .matematica { background-color: #9B5B87; color: white; }
        .sistemi-reti { background-color: #A0B7A8; color: black; }
        .scienze-motorie { background-color: #E9B89C; color: black; }
        .educazione-civica { background-color: #BF5B5B; color: white; }
        .classroom { background-color: #E5D6B9; color: black; }
        .religione { background-color: #D59BBA; color: black; }

        /* Vibrant Palette */
        .vibrant .informatica { background-color: #FF4136; color: white; }
        .vibrant .lingua-inglese { background-color: #FF851B; color: black; }
        .vibrant .gestione-progetto { background-color: #FFDC00; color: black; }
        .vibrant .lettere { background-color: #2ECC40; color: white; }
        .vibrant .tp-informatici { background-color: #0074D9; color: white; }
        .vibrant .matematica { background-color: #B10DC9; color: white; }
        .vibrant .sistemi-reti { background-color: #01FF70; color: black; }
        .vibrant .scienze-motorie { background-color: #F012BE; color: white; }
        .vibrant .educazione-civica { background-color: #7FDBFF; color: black; }
        .vibrant .classroom { background-color: #39CCCC; color: black; }
        .vibrant .religione { background-color: #85144b; color: white; }

        /* Pastel Palette */
        .pastel .informatica { background-color: #FFB3BA; color: black; }
        .pastel .lingua-inglese { background-color: #FFDFBA; color: black; }
        .pastel .gestione-progetto { background-color: #FFFFBA; color: black; }
        .pastel .lettere { background-color: #BAFFC9; color: black; }
        .pastel .tp-informatici { background-color: #BAE1FF; color: black; }
        .pastel .matematica { background-color: #E1BAFF; color: black; }
        .pastel .sistemi-reti { background-color: #C7FFBA; color: black; }
        .pastel .scienze-motorie { background-color: #FFBAE1; color: black; }
        .pastel .educazione-civica { background-color: #BAD7FF; color: black; }
        .pastel .classroom { background-color: #FFBAB8; color: black; }
        .pastel .religione { background-color: #D4BAFF; color: black; }
    </style>
</head>
<body>
    <h1>Tao's - Timetable</h1>
    
    <div id="current-future-classes">
        <div id="current-class-container" class="class-info">
            <h2>Current Class</h2>
            <div id="current-class">Loading...</div>
            <div id="current-time"></div>
        </div>
        <div id="future-class-container" class="class-info">
            <h2>Future Class</h2>
            <div id="future-class">Loading...</div>
            <div id="future-time"></div>
        </div>
    </div>

    <div id="search-container">
        <input type="text" id="search-input" placeholder="Search for classes...">
    </div>
    
    <div id="color-palette">
        <div class="palette-option active" data-palette="default" style="background-color: #3498db;"></div>
        <div class="palette-option" data-palette="vibrant" style="background-color: #FF4136;"></div>
        <div class="palette-option" data-palette="pastel" style="background-color: #FFB3BA;"></div>
    </div>
    
    <div id="controls">
        <button id="saveButton">Save Timetable</button>
        <button id="clearButton">Clear Timetable</button>
    </div>
    
    <div class="container">
        <div id="timetable-container">
            <table id="timetable"></table>
        </div>
        <div id="draggables">
            <div class="draggable-section">
                <h2>Subjects</h2>
                <div id="subjects"></div>
            </div>
            <div class="draggable-section">
                <h2>Classrooms</h2>
                <details open>
                    <summary>100s</summary>
                    <div id="100s"></div>
                </details>
                <details>
                    <summary>200s</summary>
                    <div id="200s"></div>
                </details>
                <details>
                    <summary>300s</summary>
                    <div id="300s"></div>
                </details>
                <details>
                    <summary>Other Classrooms</summary>
                    <div id="other-rooms"></div>
                </details>
            </div>
        </div>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.1/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.1/firebase-database-compat.min.js"></script>
    <script>
        const subjects = [
            { id: 'informatica', name: 'Informatica', color: 'informatica' },
            { id: 'lingua-inglese', name: 'Lingua Inglese', color: 'lingua-inglese' },
            { id: 'gestione-progetto', name: 'Gestione Progetto', color: 'gestione-progetto' },
            { id: 'lettere', name: 'Lettere', color: 'lettere' },
            { id: 'tp-informatici', name: 'TP informatici', color: 'tp-informatici' },
            { id: 'matematica', name: 'Matematica', color: 'matematica' },
            { id: 'sistemi-reti', name: 'Sistemi e reti', color: 'sistemi-reti' },
            { id: 'scienze-motorie', name: 'Scienze motorie', color: 'scienze-motorie' },
            { id: 'educazione-civica', name: 'Educazione civica', color: 'educazione-civica' },
            { id: 'religione', name: 'Religione', color: 'religione' },
        ];

        const classrooms = {
            '100s': ['101', '102', '103', '104', '105', '106', '107', '108', '109', '110', '111', '112', '113', '114', '115'],
            '200s': ['201', '202', '203', '204', '205', '206', '207', '208', '209', '210'],
            '300s': ['301', '302', '303', '304'],
            'other': ['Geo', 'Info1', 'Info2', 'Info3', 'Info4', 'Info5', 'Comp', 'Palestra Principale', 'Palestra Ungaretti', 'FabLab']
        };

        const days = ['Lunedì', 'Martedì', 'Mercoledì', 'Giovedì', 'Venerdì'];
        const times = [
            '8:00-8:50', '8:50-9:40', 'Intervallo (10 min)',
            '9:50-10:40', '10:40-11:30', 'Intervallo (7 min)',
            '11:37-12:27', '12:27-13:17', 'Pranzo',
            '14:12-15:06', '15:06-16:00'
        ];

        function createTimetable() {
            const table = document.getElementById('timetable');
            const headerRow = table.insertRow();
            headerRow.insertCell();
            days.forEach(day => {
                const th = document.createElement('th');
                th.textContent = day;
                headerRow.appendChild(th);
            });

            times.forEach(time => {
                const row = table.insertRow();
                const timeCell = row.insertCell();
                timeCell.textContent = time;
                
                if (time.includes('Intervallo') || time === 'Pranzo') {
                    days.forEach(() => {
                        const cell = row.insertCell();
                        cell.classList.add('interval');
                        cell.textContent = time.includes('Intervallo') ? 'Intervallo' : 'Pranzo';
                    });
                } else {
                    days.forEach(() => {
                        const cell = row.insertCell();
                        cell.classList.add('timeslot');
                        cell.setAttribute('droppable', 'true');
                        const contentDiv = document.createElement('div');
                        contentDiv.classList.add('timeslot-content');
                        const subjectDiv = document.createElement('div');
                        subjectDiv.classList.add('timeslot-subject');
                        const classroomDiv = document.createElement('div');
                        classroomDiv.classList.add('timeslot-classroom');
                        contentDiv.appendChild(subjectDiv);
                        contentDiv.appendChild(classroomDiv);
                        cell.appendChild(contentDiv);
                        setupDropZone(cell);
                    });
                }
            });
        }

        function createDraggables(items, containerId, itemClass) {
            const container = document.getElementById(containerId);
            items.forEach(item => {
                const element = document.createElement('div');
                element.textContent = typeof item === 'object' ? item.name : item;
                element.classList.add(itemClass, typeof item === 'object' ? item.color : 'classroom');
                element.setAttribute('draggable', 'true');
                element.id = typeof item === 'object' ? item.id : item;
                setupDraggable(element);
                container.appendChild(element);
            });
        }

        function setupDraggable(element) {
            element.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', element.id);
                e.dataTransfer.setData('itemType', element.classList.contains('subject') ? 'subject' : 'classroom');
            });
        }

        function setupDropZone(element) {
            element.addEventListener('dragover', (e) => {
                e.preventDefault();
                element.classList.add('dragover');
            });

            element.addEventListener('dragleave', () => {
                element.classList.remove('dragover');
            });

            element.addEventListener('drop', (e) => {
                e.preventDefault();
                element.classList.remove('dragover');
                const id = e.dataTransfer.getData('text');
                const itemType = e.dataTransfer.getData('itemType');
                
                const contentDiv = element.querySelector('.timeslot-content');
                const subjectDiv = contentDiv.querySelector('.timeslot-subject');
                const classroomDiv = contentDiv.querySelector('.timeslot-classroom');

                if (itemType === 'subject') {
                    const subject = subjects.find(s => s.id === id);
                    if (subject) {
                        subjectDiv.textContent = subject.name;
                        element.className = 'timeslot ' + subject.color;
                    }
                } else if (itemType === 'classroom') {
                    classroomDiv.textContent = id;
                }

                saveTimetable(); // Save after each change
            });
        }

        function saveTimetable() {
            const timetableData = [];
            const timeslots = document.querySelectorAll('.timeslot');
            timeslots.forEach((timeslot, index) => {
                const subjectDiv = timeslot.querySelector('.timeslot-subject');
                const classroomDiv = timeslot.querySelector('.timeslot-classroom');
                timetableData.push({
                    index: index,
                    subject: subjectDiv.textContent,
                    classroom: classroomDiv.textContent,
                    color: timeslot.className.split(' ')[1] // Assumes the second class is the color
                });
            });
            localStorage.setItem('timetableData', JSON.stringify(timetableData));
        }

        function loadTimetable() {
            const savedData = localStorage.getItem('timetableData');
            if (savedData) {
                const timetableData = JSON.parse(savedData);
                const timeslots = document.querySelectorAll('.timeslot');
                timetableData.forEach(data => {
                    const timeslot = timeslots[data.index];
                    const contentDiv = timeslot.querySelector('.timeslot-content');
                    const subjectDiv = contentDiv.querySelector('.timeslot-subject');
                    const classroomDiv = contentDiv.querySelector('.timeslot-classroom');
                    subjectDiv.textContent = data.subject;
                    classroomDiv.textContent = data.classroom;
                    timeslot.className = 'timeslot ' + data.color;
                });
            }
        }

        function clearTimetable() {
            const timeslots = document.querySelectorAll('.timeslot');
            timeslots.forEach(timeslot => {
                const contentDiv = timeslot.querySelector('.timeslot-content');
                const subjectDiv = contentDiv.querySelector('.timeslot-subject');
                const classroomDiv = contentDiv.querySelector('.timeslot-classroom');
                subjectDiv.textContent = '';
                classroomDiv.textContent = '';
                timeslot.className = 'timeslot';
            });
            localStorage.removeItem('timetableData');
        }

        createTimetable();
        createDraggables(subjects, 'subjects', 'subject');
        createDraggables(classrooms['100s'], '100s', 'classroom');
        createDraggables(classrooms['200s'], '200s', 'classroom');
        createDraggables(classrooms['300s'], '300s', 'classroom');
        createDraggables(classrooms['other'], 'other-rooms', 'classroom');

        // Load saved timetable data
        loadTimetable();

        // Set up event listeners for save and clear buttons
        document.getElementById('saveButton').addEventListener('click', saveTimetable);
        document.getElementById('clearButton').addEventListener('click', clearTimetable);

        // Add these new functions and event listeners

        // Search functionality
        const searchInput = document.getElementById('search-input');
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const allClasses = document.querySelectorAll('.subject, .classroom');
            
            allClasses.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'inline-block';
                } else {
                    item.style.display = 'none';
                }
            });
        });

        // Color palette functionality
        const colorPalette = document.getElementById('color-palette');
        const paletteOptions = colorPalette.querySelectorAll('.palette-option');

        paletteOptions.forEach(option => {
            option.addEventListener('click', function() {
                const palette = this.getAttribute('data-palette');
                document.body.className = palette;
                
                paletteOptions.forEach(opt => opt.classList.remove('active'));
                this.classList.add('active');

                // Update the timetable colors
                updateTimetableColors();
            });
        });

        function updateTimetableColors() {
            const timeslots = document.querySelectorAll('.timeslot');
            timeslots.forEach(timeslot => {
                const subjectElement = timeslot.querySelector('.timeslot-subject');
                if (subjectElement) {
                    const subject = subjectElement.textContent.toLowerCase().replace(/\s+/g, '-');
                    timeslot.className = `timeslot ${subject}`;
                }
            });
        }

        // Call this function after loading the timetable
        updateTimetableColors();

        function updateCurrentClass() {
            const now = new Date();
            const day = now.getDay(); // 0 (Sunday) to 6 (Saturday)
            const hours = now.getHours();
            const minutes = now.getMinutes();

            const currentClass = getCurrentClass(day, hours, minutes);
            const currentClassElement = document.getElementById('current-class');
            const currentTimeElement = document.getElementById('current-time');

            currentClassElement.textContent = currentClass || 'No class at this time';
            currentTimeElement.textContent = `Current Time: ${formatTime(hours, minutes)}`;
        }

        function getCurrentClass(day, hours, minutes) {
            // This is a simplified example. You'll need to adjust this based on your actual schedule.
            const schedule = {
                1: [ // Monday
                    { start: '08:00', end: '08:50', class: 'Informatica' },
                    { start: '08:50', end: '09:40', class: 'Lingua Inglese' },
                    // ... add more classes for Monday
                ],
                2: [ // Tuesday
                    { start: '08:00', end: '08:50', class: 'Matematica' },
                    { start: '08:50', end: '09:40', class: 'Lettere' },
                    // ... add more classes for Tuesday
                ],
                // ... add schedules for other days
            };

            if (day === 0 || day === 6) return 'Weekend'; // No classes on weekends

            const daySchedule = schedule[day];
            if (!daySchedule) return 'No classes today';

            const currentTime = hours * 60 + minutes;

            for (const period of daySchedule) {
                const [startHour, startMinute] = period.start.split(':').map(Number);
                const [endHour, endMinute] = period.end.split(':').map(Number);
                const startTime = startHour * 60 + startMinute;
                const endTime = endHour * 60 + endMinute;

                if (currentTime >= startTime && currentTime < endTime) {
                    return period.class;
                }
            }

            return 'No class at this time';
        }

        function formatTime(hours, minutes) {
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
        }

        // Update current class every minute
        setInterval(updateCurrentClass, 60000);
        updateCurrentClass();
        function setupMobileDraggable(element) {
    element.addEventListener('touchstart', handleTouchStart, false);
    element.addEventListener('touchmove', handleTouchMove, false);
    element.addEventListener('touchend', handleTouchEnd, false);
}

let draggedElement = null;

function handleTouchStart(e) {
    draggedElement = this;
    e.preventDefault();
}

function handleTouchMove(e) {
    e.preventDefault();
}

function handleTouchEnd(e) {
    e.preventDefault();
    const touch = e.changedTouches[0];
    const target = document.elementFromPoint(touch.clientX, touch.clientY);
    
    if (target && target.classList.contains('timeslot')) {
        const contentDiv = target.querySelector('.timeslot-content');
        const subjectDiv = contentDiv.querySelector('.timeslot-subject');
        const classroomDiv = contentDiv.querySelector('.timeslot-classroom');

        if (draggedElement.classList.contains('subject')) {
            const subject = subjects.find(s => s.id === draggedElement.id);
            if (subject) {
                subjectDiv.textContent = subject.name;
                target.className = 'timeslot ' + subject.color;
            }
        } else if (draggedElement.classList.contains('classroom')) {
            classroomDiv.textContent = draggedElement.id;
        }

        saveTimetable();
    }

    draggedElement = null;
}

// Update createDraggables function to add mobile support
function createDraggables(items, containerId, itemClass) {
    const container = document.getElementById(containerId);
    items.forEach(item => {
        const element = document.createElement('div');
        element.textContent = typeof item === 'object' ? item.name : item;
        element.classList.add(itemClass, typeof item === 'object' ? item.color : 'classroom');
        element.setAttribute('draggable', 'true');
        element.id = typeof item === 'object' ? item.id : item;
        setupDraggable(element);
        setupMobileDraggable(element);
        container.appendChild(element);
    });
}

// Update the getCurrentClass and add getFutureClass functions
function getCurrentClass(day, hours, minutes) {
    return getClassAtTime(day, hours, minutes);
}

function getFutureClass(day, hours, minutes) {
    // Add one hour to the current time
    minutes += 60;
    if (minutes >= 60) {
        hours += 1;
        minutes -= 60;
    }
    if (hours >= 24) {
        day += 1;
        hours -= 24;
    }
    if (day > 5) day = 1; // Wrap to Monday if it's weekend

    return getClassAtTime(day, hours, minutes);
}

function getClassAtTime(day, hours, minutes) {
    // This is a simplified example. You'll need to adjust this based on your actual schedule.
    const schedule = {
        1: [ // Monday
            { start: '08:00', end: '08:50', class: 'Informatica' },
            { start: '08:50', end: '09:40', class: 'Lingua Inglese' },
            // ... add more classes for Monday
        ],
        2: [ // Tuesday
            { start: '08:00', end: '08:50', class: 'Matematica' },
            { start: '08:50', end: '09:40', class: 'Lettere' },
            // ... add more classes for Tuesday
        ],
        // ... add schedules for other days
    };

    if (day === 0 || day === 6) return 'Weekend'; // No classes on weekends

    const daySchedule = schedule[day];
    if (!daySchedule) return 'No classes today';

    const currentTime = hours * 60 + minutes;

    for (const period of daySchedule) {
        const [startHour, startMinute] = period.start.split(':').map(Number);
        const [endHour, endMinute] = period.end.split(':').map(Number);
        const startTime = startHour * 60 + startMinute;
        const endTime = endHour * 60 + endMinute;

        if (currentTime >= startTime && currentTime < endTime) {
            return `${period.class} (${period.start} - ${period.end})`;
        }
    }

    return 'No class at this time';
}

// Update the updateCurrentClass function to include future class
function updateCurrentClass() {
    const now = new Date();
    const day = now.getDay(); // 0 (Sunday) to 6 (Saturday)
    const hours = now.getHours();
    const minutes = now.getMinutes();

    const currentClass = getCurrentClass(day, hours, minutes);
    const futureClass = getFutureClass(day, hours, minutes);

    const currentClassElement = document.getElementById('current-class');
    const currentTimeElement = document.getElementById('current-time');
    const futureClassElement = document.getElementById('future-class');
    const futureTimeElement = document.getElementById('future-time');

    currentClassElement.textContent = currentClass || 'No class at this time';
    currentTimeElement.textContent = `Current Time: ${formatTime(hours, minutes)}`;

    futureClassElement.textContent = futureClass || 'No class in the next hour';
    const futureTime = new Date(now.getTime() + 60 * 60 * 1000);
    futureTimeElement.textContent = `At: ${formatTime(futureTime.getHours(), futureTime.getMinutes())}`;
}
// Firebase configuration and initialization
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    databaseURL: "YOUR_DATABASE_URL",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
    appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);

// Timetable data
const subjects = [
    { id: 'informatica', name: 'Informatica', color: 'informatica' },
    { id: 'lingua-inglese', name: 'Lingua Inglese', color: 'lingua-inglese' },
    { id: 'gestione-progetto', name: 'Gestione Progetto', color: 'gestione-progetto' },
    { id: 'lettere', name: 'Lettere', color: 'lettere' },
    { id: 'tp-informatici', name: 'TP informatici', color: 'tp-informatici' },
    { id: 'matematica', name: 'Matematica', color: 'matematica' },
    { id: 'sistemi-reti', name: 'Sistemi e reti', color: 'sistemi-reti' },
    { id: 'scienze-motorie', name: 'Scienze motorie', color: 'scienze-motorie' },
    { id: 'educazione-civica', name: 'Educazione civica', color: 'educazione-civica' },
    { id: 'religione', name: 'Religione', color: 'religione' },
];

const classrooms = {
    '100s': ['101', '102', '103', '104', '105', '106', '107', '108', '109', '110', '111', '112', '113', '114', '115'],
    '200s': ['201', '202', '203', '204', '205', '206', '207', '208', '209', '210'],
    '300s': ['301', '302', '303', '304'],
    'other': ['Geo', 'Info1', 'Info2', 'Info3', 'Info4', 'Info5', 'Comp', 'Palestra Principale', 'Palestra Ungaretti', 'FabLab']
};

const days = ['Lunedì', 'Martedì', 'Mercoledì', 'Giovedì', 'Venerdì'];
const times = [
    '8:00-8:50', '8:50-9:40', 'Intervallo (10 min)',
    '9:50-10:40', '10:40-11:30', 'Intervallo (7 min)',
    '11:37-12:27', '12:27-13:17', 'Pranzo',
    '14:12-15:06', '15:06-16:00'
];

// Create timetable structure
function createTimetable() {
    const table = document.getElementById('timetable');
    const headerRow = table.insertRow();
    headerRow.insertCell();
    days.forEach(day => {
        const th = document.createElement('th');
        th.textContent = day;
        headerRow.appendChild(th);
    });

    times.forEach(time => {
        const row = table.insertRow();
        const timeCell = row.insertCell();
        timeCell.textContent = time;
        
        if (time.includes('Intervallo') || time === 'Pranzo') {
            days.forEach(() => {
                const cell = row.insertCell();
                cell.classList.add('interval');
                cell.textContent = time.includes('Intervallo') ? 'Intervallo' : 'Pranzo';
            });
        } else {
            days.forEach(() => {
                const cell = row.insertCell();
                cell.classList.add('timeslot');
                cell.setAttribute('droppable', 'true');
                const contentDiv = document.createElement('div');
                contentDiv.classList.add('timeslot-content');
                const subjectDiv = document.createElement('div');
                subjectDiv.classList.add('timeslot-subject');
                const classroomDiv = document.createElement('div');
                classroomDiv.classList.add('timeslot-classroom');
                contentDiv.appendChild(subjectDiv);
                contentDiv.appendChild(classroomDiv);
                cell.appendChild(contentDiv);
                setupDropZone(cell);
            });
        }
    });
}

// Create draggable elements
function createDraggables(items, containerId, itemClass) {
    const container = document.getElementById(containerId);
    items.forEach(item => {
        const element = document.createElement('div');
        element.textContent = typeof item === 'object' ? item.name : item;
        element.classList.add(itemClass, typeof item === 'object' ? item.color : 'classroom');
        element.setAttribute('draggable', 'true');
        element.id = typeof item === 'object' ? item.id : item;
        setupDraggable(element);
        setupMobileDraggable(element);
        container.appendChild(element);
    });
}

// Set up draggable functionality
function setupDraggable(element) {
    element.addEventListener('dragstart', (e) => {
        e.dataTransfer.setData('text/plain', element.id);
        e.dataTransfer.setData('itemType', element.classList.contains('subject') ? 'subject' : 'classroom');
    });
}

// Set up drop zone functionality
function setupDropZone(element) {
    element.addEventListener('dragover', (e) => {
        e.preventDefault();
        element.classList.add('dragover');
    });

    element.addEventListener('dragleave', () => {
        element.classList.remove('dragover');
    });

    element.addEventListener('drop', (e) => {
        e.preventDefault();
        element.classList.remove('dragover');
        handleDrop(element, e.dataTransfer.getData('text'), e.dataTransfer.getData('itemType'));
    });
}

// Handle drop event
function handleDrop(element, id, itemType) {
    const contentDiv = element.querySelector('.timeslot-content');
    const subjectDiv = contentDiv.querySelector('.timeslot-subject');
    const classroomDiv = contentDiv.querySelector('.timeslot-classroom');

    if (itemType === 'subject') {
        const subject = subjects.find(s => s.id === id);
        if (subject) {
            subjectDiv.textContent = subject.name;
            element.className = 'timeslot ' + subject.color;
        }
    } else if (itemType === 'classroom') {
        classroomDiv.textContent = id;
    }

    saveTimetable();
}

// Save timetable data
function saveTimetable() {
    const timetableData = [];
    const timeslots = document.querySelectorAll('.timeslot');
    timeslots.forEach((timeslot, index) => {
        const subjectDiv = timeslot.querySelector('.timeslot-subject');
        const classroomDiv = timeslot.querySelector('.timeslot-classroom');
        timetableData.push({
            index: index,
            subject: subjectDiv.textContent,
            classroom: classroomDiv.textContent,
            color: timeslot.className.split(' ')[1]
        });
    });
    
    localStorage.setItem('timetableData', JSON.stringify(timetableData));
    firebase.database().ref('timetables/default').set(timetableData);
}

// Load timetable data
function loadTimetable() {
    firebase.database().ref('timetables/default').once('value').then((snapshot) => {
        const firebaseData = snapshot.val();
        if (firebaseData) {
            applyTimetableData(firebaseData);
        } else {
            const localData = localStorage.getItem('timetableData');
            if (localData) {
                applyTimetableData(JSON.parse(localData));
            }
        }
    }).catch((error) => {
        console.error("Error loading from Firebase:", error);
        const localData = localStorage.getItem('timetableData');
        if (localData) {
            applyTimetableData(JSON.parse(localData));
        }
    });
}

// Apply timetable data to the UI
function applyTimetableData(timetableData) {
    const timeslots = document.querySelectorAll('.timeslot');
    timetableData.forEach(data => {
        const timeslot = timeslots[data.index];
        const contentDiv = timeslot.querySelector('.timeslot-content');
        const subjectDiv = contentDiv.querySelector('.timeslot-subject');
        const classroomDiv = contentDiv.querySelector('.timeslot-classroom');
        subjectDiv.textContent = data.subject;
        classroomDiv.textContent = data.classroom;
        timeslot.className = 'timeslot ' + data.color;
    });
}

// Clear timetable data
function clearTimetable() {
    const timeslots = document.querySelectorAll('.timeslot');
    timeslots.forEach(timeslot => {
        const contentDiv = timeslot.querySelector('.timeslot-content');
        const subjectDiv = contentDiv.querySelector('.timeslot-subject');
        const classroomDiv = contentDiv.querySelector('.timeslot-classroom');
        subjectDiv.textContent = '';
        classroomDiv.textContent = '';
        timeslot.className = 'timeslot';
    });
    localStorage.removeItem('timetableData');
    firebase.database().ref('timetables/default').remove();
}

// Set up mobile touch functionality
function setupMobileDraggable(element) {
    let isDragging = false;
    let startX, startY;

    element.addEventListener('touchstart', function(e) {
        isDragging = true;
        startX = e.touches[0].clientX - element.offsetLeft;
        startY = e.touches[0].clientY - element.offsetTop;
        e.preventDefault();
    }, { passive: false });

    element.addEventListener('touchmove', function(e) {
        if (isDragging) {
            e.preventDefault();
            let touchX = e.touches[0].clientX - startX;
            let touchY = e.touches[0].clientY - startY;
            element.style.position = 'fixed';
            element.style.left = touchX + 'px';
            element.style.top = touchY + 'px';
        }
    }, { passive: false });

    element.addEventListener('touchend', function(e) {
        if (isDragging) {
            isDragging = false;
            element.style.position = 'static';
            const touch = e.changedTouches[0];
            const target = document.elementFromPoint(touch.clientX, touch.clientY);
            
            if (target && target.classList.contains('timeslot')) {
                handleDrop(target, element.id, element.classList.contains('subject') ? 'subject' : 'classroom');
            }
        }
    }, { passive: false });
}

// Update current and future class information
function updateCurrentClass() {
    const now = new Date();
    const day = now.getDay();
    const hours = now.getHours();
    const minutes = now.getMinutes();

    const currentClass = getClassAtTime(day, hours, minutes);
    const futureClass = getClassAtTime(day, (hours + 1) % 24, minutes);

    document.getElementById('current-class').textContent = currentClass || 'No class at this time';
    document.getElementById('current-time').textContent = `Current Time: ${formatTime(hours, minutes)}`;

    document.getElementById('future-class').textContent = futureClass || 'No class in the next hour';
    const futureTime = new Date(now.getTime() + 60 * 60 * 1000);
    document.getElementById('future-time').textContent = `At: ${formatTime(futureTime.getHours(), futureTime.getMinutes())}`;
}

// Get class information for a specific time
function getClassAtTime(day, hours, minutes) {
    const schedule = {
        1: [ // Monday
            { start: '08:00', end: '08:50', class: 'Informatica' },
            { start: '08:50', end: '09:40', class: 'Lingua Inglese' },
            // Add more classes for Monday
        ],
        2: [ // Tuesday
            { start: '08:00', end: '08:50', class: 'Matematica' },
            { start: '08:50', end: '09:40', class: 'Lettere' },
            // Add more classes for Tuesday
        ],
        // Add schedules for other days (3, 4, 5)
    };

    if (day === 0 || day === 6) return 'Weekend';
    const daySchedule = schedule[day];
    if (!daySchedule) return 'No classes today';

    const currentTime = hours * 60 + minutes;
    for (const period of daySchedule) {
        const [startHour, startMinute] = period.start.split(':').map(Number);
        const [endHour, endMinute] = period.end.split(':').map(Number);
        const startTime = startHour * 60 + startMinute;
        const endTime = endHour * 60 + endMinute;

        if (currentTime >= startTime && currentTime < endTime) {
            return `${period.class} (${period.start} - ${period.end})`;
        }
    }

    return 'No class at this time';
}

// Format time as HH:MM
function formatTime(hours, minutes) {
    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
}

// Search functionality
function setupSearch() {
    const searchInput = document.getElementById('search-input');
    searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const allClasses = document.querySelectorAll('.subject, .classroom');
        
        allClasses.forEach(item => {
            const text = item.textContent.toLowerCase();
            if (text.includes(searchTerm)) {
                item.style.display = 'inline-block';
            } else {
                item.style.display = 'none';
            }
        });
    });
}

// Color palette functionality
function setupColorPalette() {
    const colorPalette = document.getElementById('color-palette');
    const paletteOptions = colorPalette.querySelectorAll('.palette-option');

    paletteOptions.forEach(option => {
        option.addEventListener('click', function() {
            const palette = this.getAttribute('data-palette');
            document.body.className = palette;
            
            paletteOptions.forEach(opt => opt.classList.remove('active'));
            this.classList.add('active');

            updateTimetableColors();
        });
    });
}

function updateTimetableColors() {
    const timeslots = document.querySelectorAll('.timeslot');
    timeslots.forEach(timeslot => {
        const subjectElement = timeslot.querySelector('.timeslot-subject');
        if (subjectElement) {
            const subject = subjectElement.textContent.toLowerCase().replace(/\
    </script>
</body>
</html>
